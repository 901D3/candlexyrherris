<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" name="viewport" content="width=device-width,initial-scale=1" />
    <title data-text="$title"></title>
    <meta name="description" content="A tool for audio processing and playback" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/unifont@5.1.0/index.min.css" />
    <link rel="icon" href="favicon.ico" />
    <script src="https://unpkg.com/default-passive-events"></script>
  </head>
  <body class="display-flex top-bottom-flow" style="gap: 8px">
    <div class="display-flex top-bottom-flow" style="gap: 15px">
      <span
        class="glowfire font-size text-align-center vertical-align-top-margin color font-weight-bold"
        style="--font-size: 175px"
        data-text="$title"
        data-text-id="title"></span>
      <span
        class="text-align-center font-weight-bold font-size"
        style="--font-size: 25px"
        data-text="$subtitle"
        data-text-id="subtitle"></span>
      <div class="firehr"></div>
    </div>
    <div class="display-flex left-right-flow width-fit-content" style="gap: 15px">
      <div class="display-flex top-bottom-flow" style="gap: 12px">
        <span class="font-weight-bold font-size" style="--font-size: 20px" data-text="$upload" data-text-id="loadAudio"></span>
        <input type="file" id="uploadFile" class="height-fit-content" title=".wav, .mp3" accept=".wav, .mp3" />
        <span
          class="font-weight-bold font-size"
          style="--font-size: 20px"
          data-text="$paste_link"
          data-text-id="loadAudio"></span>
        <input type="text" id="linkUrl" />
        <button id="updateAudioSrc" onclick="updateAudioSrc()" class="width height-fit-content" style="--width: 60px">
          <span data-text="$update" data-text-id="linkAudio"></span>
        </button>
      </div>
      <div class="display-flex top-bottom-flow width-fit-content" style="gap: 12px">
        <span class="font-weight-bold font-size" style="--font-size: 20px" data-text="$recorder" data-text-id="recorder"></span>
        <div class="display-flex left-right-flow width-fit-content" style="gap: 12px">
          <button
            id="startRecording"
            class="width height margin padding"
            type="button"
            style="--width: 40px; --height: 40px; --margin: 0px; --padding: 0px">
            <div class="horizontal-align-center vertical-align-center-margin record"></div>
          </button>
          <button
            id="stopRecording"
            class="width height margin padding"
            type="button"
            disabled=""
            style="--width: 40px; --height: 40px; --margin: 0px; --padding: 0px">
            <div class="horizontal-align-center vertical-align-center-margin stopRecord"></div>
          </button>
          <span class="vertical-align-center-margin">[F1] [SHIFT + F1]</span>
        </div>
        <div class="display-flex left-right-flow width-fit-content" style="gap: 12px">
          <button
            id="pauseRecording"
            class="width height margin padding"
            disabled=""
            type="button"
            style="--width: 40px; --height: 40px; --margin: 0px; --padding: 0px">
            <div class="horizontal-align-center width-fit-content height-fit-content display-flex left-right-flow">
              <div
                class="vertical-align-center-margin width height background-color"
                style="
                  --width: 5px;
                  --height: 16px;
                  --background-color-r: 255;
                  --background-color-g: 255;
                  --background-color-b: 255;
                "></div>
              <div
                class="vertical-align-center-margin width height background-color margin-left"
                style="
                  --width: 5px;
                  --height: 16px;
                  --background-color-r: 255;
                  --background-color-g: 255;
                  --background-color-b: 255;
                  --margin-left: 6px;
                "></div>
            </div>
          </button>
          <button
            id="resumeRecording"
            class="width height margin padding"
            type="button"
            disabled=""
            style="--width: 40px; --height: 40px; --margin: 0px; --padding: 0px">
            <div>resume</div>
          </button>
          <span class="vertical-align-center-margin">[F4]</span>
        </div>
      </div>
      <div class="settings_container">
        <div class="settings_label-input_long">
          <span data-text="$mime_type"></span>
          <input id="recorderMimeTypeInput" placeholder="video/webm" value="video/webm" />
        </div>
        <div class="settings_label-input_long">
          <span data-text="$codec"></span>
          <input id="recorderCodecInput" placeholder="vp9" value="vp9" />
        </div>
        <div class="settings_label-slider-input">
          <span data-text="$frame_rate"></span>
          <input type="range" id="recorderFrameRateRange" min="0" max="120" step="0.00000000001" />
          <input type="number" id="recorderFrameRateInput" placeholder="30" value="30" />
        </div>
        <div class="settings_label-slider-input">
          <span data-text="$bitrate"></span>
          <input type="range" id="recorderVideoBitrateRange" min="0" max="100000000" step="1" />
          <input type="number" id="recorderVideoBitrateInput" placeholder="2000000" value="2000000" />
        </div>
        <div class="settings_label-input_long">
          <span data-text="$file_name"></span>
          <input id="recorderFileName" placeholder="" value="" />
        </div>
      </div>
    </div>
    <div class="bigContainer left-right-flow" style="gap: 20px">
      <div class="controls">
        <div class="display-flex top-bottom-flow width" style="--width: 100%; gap: 10px">
          <div class="settings_container">
            <span class="settings_label_title" data-text="$audio_settings_title"></span>
            <div class="settings_label-slider-input">
              <span data-text="$vol_multiplier"></span>
              <input type="range" id="volumeMultiplierRange" min="0" max="10" step="0.00000000001" />
              <input type="number" id="volumeMultiplierInput" placeholder="1" value="1" />
            </div>
            <div class="settings_label-slider-input">
              <span data-text="$fft_size" class="barsPerBinIndic"></span>
              <input type="range" id="fftSizeRange" min="1" max="16384" step="1" />
              <input type="number" id="fftSizeInput" placeholder="1600" value="1600" />
            </div>
            <div class="settings_label-slider-input">
              <span data-text="$min_amplitude"></span>
              <input type="range" id="minAmplitudeRange" min="0" max="1" step="0.00000000001" />
              <input type="number" id="minAmplitudeInput" placeholder="0" value="0" />
            </div>
            <div class="settings_label-slider-input">
              <span data-text="$max_amplitude"></span>
              <input type="range" id="maxAmplitudeRange" min="0" max="1" step="0.00000000001" />
              <input type="number" id="maxAmplitudeInput" placeholder="1" value="1" />
            </div>
            <div class="settings_label-slider-input">
              <span data-text="$threshold"></span>
              <input type="range" id="thresholdRange" min="0" max="1" step="0.00000000001" />
              <input type="number" id="thresholdInput" placeholder="0" value="0" />
            </div>
            <div class="settings_label-slider-input">
              <span data-text="$min_frequency" class="barsPerBinIndic"></span>
              <input type="range" id="minFrequencyRange" min="0" max="20000" step="1" />
              <input type="number" id="minFrequencyInput" placeholder="0" value="0" />
            </div>
            <div class="settings_label-slider-input">
              <span data-text="$max_frequency" class="barsPerBinIndic"></span>
              <input type="range" id="maxFrequencyRange" min="0" max="20000" step="1" />
              <input type="number" id="maxFrequencyInput" placeholder="3000" value="3000" />
            </div>
            <div class="settings_label-label_info">
              <span data-text="$current_freq_range"></span>
              <span id="freqRangeLbl" class="info">Hz</span>
            </div>
            <div class="whitehr"></div>
            <div class="settings_label-select">
              <span data-text="$window_function"></span>
              <select id="windowFuncSelect">
                <option value="rect" selected="true" data-text="$rect"></option>
                <option value="triangular" data-text="$triangular"></option>
                <option value="welch" data-text="$welch"></option>
                <option value="cosine" data-text="$cosine"></option>
                <option value="bartlett" data-text="$bartlett"></option>
                <option value="barthann" data-text="$barthann"></option>
                <option value="hann" data-text="$hann"></option>
                <option value="hamming" data-text="$hamming"></option>
                <option value="blackman" data-text="$blackman"></option>
                <option value="nuttall" data-text="$nuttall"></option>
                <option value="blackmanNuttall" data-text="$blackman_nuttall"></option>
                <option value="blackmanHarris" data-text="$blackman_harris"></option>
                <option value="flatTop" data-text="$flat_top"></option>
                <option value="bartlettHann" data-text="$bartlett_hann"></option>
                <option value="gaussian" data-text="$gaussian"></option>
                <option value="exponential" data-text="$exponential"></option>
                <option value="lanczos" data-text="$lanczos"></option>
              </select>
            </div>
            <textarea id="windowFuncInput">1</textarea>
          </div>
          <div class="whitehr"></div>
          <div class="settings_container">
            <span class="settings_label_title" data-text="$visualizer_settings_title"></span>
            <div class="settings_label-select">
              <span data-text="$bar_style"></span>
              <select id="barStyle">
                <option value="rect" selected="true" data-text="$rect"></option>
                <option value="capsule" data-text="$capsule"></option>
              </select>
            </div>
            <div id="capsuleRadiusDisp" class="settings_label-slider-input hidden">
              <span data-text="$capsule_radius"></span>
              <input type="range" id="barStyleCapsuleRadiusRange" min="0" max="0.5" step="0.00000000001" />
              <input type="number" id="barStyleCapsuleRadiusInput" placeholder="0.5" value="0.5" />
            </div>
            <div class="whitehr"></div>
            <div class="settings_label-slider-input">
              <span data-text="$number" class="barsPerBinIndic"></span>
              <input type="range" id="barsRange" min="1" value="100" max="512" step="1" />
              <input type="number" id="barsInput" placeholder="100" value="100" />
            </div>
            <div class="settings_label-slider-input">
              <span data-text="$width"></span>
              <input type="range" id="barWidthRange" min="0.1" max="100" step="0.00000000001" />
              <input type="number" id="barWidthInput" placeholder="10" value="10" />
            </div>
            <div class="settings_label-slider-input">
              <span data-text="$space"></span>
              <input type="range" id="barSpaceRange" min="0" max="10" step="0.00000000001" />
              <input type="number" id="barSpaceInput" placeholder="2" value="2" />
            </div>
            <div class="settings_label-slider-input" style="background-color: #ff0000; border-radius: 4px">
              <span></span>
              <input type="range" id="barColorRedRange" min="0" max="255" step="1" />
              <input type="number" id="barColorRedInput" placeholder="255" value="255" />
            </div>
            <div class="settings_label-slider-input" style="background-color: #00ff00; border-radius: 4px">
              <span></span>
              <input type="range" id="barColorGreenRange" min="0" max="255" step="1" />
              <input type="number" id="barColorGreenInput" placeholder="255" value="255" />
            </div>
            <div class="settings_label-slider-input" style="background-color: #0000ff; border-radius: 4px">
              <span></span>
              <input type="range" id="barColorBlueRange" min="0" max="255" step="1" />
              <input type="number" id="barColorBlueInput" placeholder="255" value="255" />
            </div>
            <div class="settings_label-slider-input">
              <span data-text="$frame_latency"></span>
              <input type="range" id="frameLatencyRange" min="0" max="60" step="0.00000000001" />
              <input type="number" id="frameLatencyInput" placeholder="30" value="30" />
            </div>
          </div>
          <div class="whitehr"></div>
          <div class="settings_container">
            <div class="settings_label-input">
              <span data-text="$width"></span>
              <input type="number" id="canvasWidth" placeholder="1280" value="1280" />
            </div>
            <div class="settings_label-input">
              <span data-text="$height"></span>
              <input type="number" id="canvasHeight" placeholder="720" value="720" />
            </div>
            <div class="settings_button-label">
              <button onclick="changecanvasSize()" data-text="$canvas_size_change"></button>
            </div>
            <div class="settings_checkbox-label">
              <input
                type="checkbox"
                id="canvasRendering"
                checked=""
                onchange="
                  document.getElementById('canvas').style.imageRendering = canvasRendering.checked ? 'pixelated' : 'auto';
                " />
              <span data-text="$pixelated_render"></span>
            </div>
            <div class="settings_checkbox-label">
              <input type="checkbox" id="desyncOpt" />
              <span data-text="$canvas_desync"></span>
            </div>
            <div class="settings_button-label">
              <button onclick="fullscreenCvs()" data-text="$canvas_fullscreen"></button>
              <span>[F]</span>
            </div>
          </div>
          <div class="whitehr"></div>
          <div class="settings_container_info">
            <span class="info_indicator">i</span>
            <div class="settings_label-label_info">
              <span data-text="$variables"></span>
            </div>
            <div class="settings_label-label_info">
              <span data-text="$sample_rate"></span>
              <span id="sampleRateLbl" class="info">Hz</span>
            </div>
            <div class="settings_label-label_info">
              <span data-text="$bit_depth"></span>
              <span id="bitDepthLbl" class="info">Bits</span>
            </div>
            <div class="settings_label-label_info">
              <span data-text="$number_of_channels"></span>
              <span id="channelsLbl" class="info">[Int]</span>
            </div>
            <div class="whitehr"></div>
            <div class="settings_label-label_info">
              <span data-text="$desired_freq_range"></span>
              <span id="desiredFreqRangeLbl" class="info">Hz</span>
            </div>
            <div class="settings_label-label_info">
              <span data-text="$desired_fft_size"></span>
              <span id="desiredFftSizeLbl" class="info">[Int{ceil}]</span>
            </div>
            <div class="settings_label-label_info">
              <span data-text="$desired_bars"></span>
              <span id="desiredBarsLbl" class="info">[Int{ceil}]</span>
            </div>
            <div class="whitehr"></div>
            <div class="settings_label-label_info">
              <span data-text="$bars_per_freq" class="barsPerFreqIndic"></span>
              <span id="barsPerFreqLbl" class="info">[Float]</span>
            </div>
            <div class="settings_label-label_info">
              <span data-text="$bars_per_bin" class="barsPerBinIndic"></span>
              <span id="barsPerBinLbl" class="info">[Float]</span>
            </div>
            <div class="settings_label-label_info">
              <span data-text="$freq_pre_bar" class="freqPerBarIndic"></span>
              <span id="freqPerBarLbl" class="info">Hz</span>
            </div>
            <div class="settings_label-label_info">
              <span data-text="$freq_pre_bin" class="freqPerBinIndic"></span>
              <span id="freqPerBinLbl" class="info">Hz</span>
            </div>
            <div class="settings_label-label_info">
              <span data-text="$bins_per_bar" class="binsPerBarIndic"></span>
              <span id="binsPerBarLbl" class="info">[Float]</span>
            </div>
            <div class="settings_label-label_info">
              <span data-text="$bins_per_freq" class="binsPerFreqIndic"></span>
              <span id="binsPerFreqLbl" class="info">[Float]</span>
            </div>
          </div>
        </div>
      </div>
      <div class="previewContainer">
        <div class="mainAudio">
          <audio id="audio" controls loop crossorigin="anonymous" src="" data-text="$elN_A"></audio>
        </div>
        <div class="firehr"></div>
        <div class="mainCanvas"><canvas id="canvas" width="1280" height="720" data-text="$elN_A"></canvas></div>
      </div>
    </div>
    <div class="settings_container">
      <div class="settings_checkbox-label">
        <input type="checkbox" id="showTelemetries" />
        <span data-text="$Telemetries"></span>
      </div>
    </div>
    <div class="border-width border-style-solid border-color" style="--border-width: 2px; --border-color: #1070ea">
      <div id="console"></div>
    </div>
    <div class="firehr"></div>
  </body>
  <script src="scripts/init.js"></script>

  <!--Resources-->
  <script src="scripts/resource/windowFunc.js"></script>

  <!--Libraries-->
  <script src="scripts/lib/901D3/binUtils.js"></script>
  <script src="scripts/lib/901D3/wav.js"></script>
  <script src="scripts/lib/nayuki/fft.js"></script>
  <script src="scripts/lib/aurora/aurora.js"></script>
  <script src="scripts/lib/aurora/flac.js"></script>

  <script src="scripts/recorder.js"></script>
  <script src="scripts/locale.js"></script>
  <script src="scripts/sizing.js"></script>
  <script src="scripts/audio.js"></script>
  <script src="scripts/process.js"></script>
  <script>
    const upload = gId("uploadFile");
    upload.addEventListener("change", async () => {
      const file = upload.files[0];
      if (!file) return;
      const buffer = await file.arrayBuffer();
      bytesArray = new Uint8Array(buffer);
      readWavHeader(bytesArray, bytesArray);
      audioDataArray = convertWavData(sampleRate, bitDepth, format, bytesArray, audioDataArray, 1);
      const blobUrl = URL.createObjectURL(file);
      audio.src = blobUrl;
      audio.play;
      audio.pause;
      displayInfo();
    });

    async function updateAudioSrc() {
      let linkUrl = gId("linkUrl").value;
      const audioExt = /\.wav$/i;
      if (!audioExt.test(linkUrl)) {
        printLog("Audio file has to be .wav file");
        return;
      }
      const res = await fetch(linkUrl);
      const buffer = await res.arrayBuffer();
      bytesArray = new Uint8Array(buffer);
      readWavHeader(bytesArray, bytesArray);
      audioDataArray = convertWavData(sampleRate, bitDepth, format, bytesArray, audioDataArray, 1);
      audio.src = linkUrl;
      audio.play;
      audio.pause;
      displayInfo();
    }
  </script>
</html>
